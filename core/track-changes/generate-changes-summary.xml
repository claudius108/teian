<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet xmlns="http://www.w3.org/1999/xhtml" xmlns:teian="http://kuberam.ro/ns/teian" xmlns:xsl="http://www.w3.org/1999/XSL/Transform"
	version="1.0">
	<xsl:output method="xml" />
	<xsl:variable name="changes" select="//*[local-name() = 'ins' or local-name() = 'del']" />
	<xsl:variable name="test" />
	<xsl:template match="/">
		<div class="ui-corner-all ui-helper-clearfix" id="changes-container" style="display: inline;">
			<div id="changes-container-title">Changes</div>
			<div id="track-changes-toolbar">
				<button onclick="teian.acceptAllChanges();" title="Accept all changes" id="accept-all-changes-button">Accept all</button>
				<button onclick="teian.rejectAllChanges();" title="Reject all changes" id="reject-all-changes-button">Reject all</button>
				<br />
				<button onclick="teian.goToChange('first');" title="First change" id="first-change-button">&lt;&lt;</button>
				<button onclick="teian.goToChange('previous');" title="Previous change" id="previous-change-button">&lt;</button>
				<button onclick="teian.goToChange('next');" title="Next change" id="next-change-button">&gt;</button>
				<button onclick="teian.goToChange('last');" title="Last change" id="last-change-button">&gt;&gt;</button>
			</div>
			<xsl:for-each select="$changes">
				<xsl:sort select="@timestamp" />
				<xsl:variable name="change" select="." />
				<xsl:variable name="author" select="$change/@author" />
				<div>
					<div style="{concat('background-color: ', document('')//*[@name = $author]/@color, ';')}" class="change-summary-author">
						<xsl:value-of select="$author" />
					</div>
					<div id="{concat('summary-teian-change-', generate-id())}" class="change-container">
						<div class="change-summary-title">
							<xsl:choose>
								<xsl:when test="local-name($change) = 'del'">
									<xsl:text>Deleted </xsl:text>
									<xsl:value-of select="local-name(document('')/*/*[5])" />
								</xsl:when>
								<xsl:otherwise>
									<xsl:text>Added</xsl:text>
								</xsl:otherwise>
							</xsl:choose>
							<xsl:text> on </xsl:text>
							<xsl:value-of select="$change/@timestamp" />
							<input style="float: right;" type="image" onclick="teian.acceptChange('teian-change-1363686467820', 'Deleted');"
								title="Accept change" src="../resources/images/passed.png" />
							<input style="float: right;" type="image" onclick="teian.rejectChange('teian-change-1363686467820', 'Deleted');"
								title="Reject change" src="../resources/images/failed.png" />
						</div>
						<div class="change-summary-content">
							<xsl:value-of select="$change" />
						</div>
					</div>
				</div>

			</xsl:for-each>
		</div>
	</xsl:template>	
</xsl:stylesheet>